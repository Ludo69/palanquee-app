<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des Plongeurs</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <div class="container">
        <h1 class="title">Gestion des Plongeurs</h1>

        <!-- Formulaire d'ajout de plongeur -->
        <form action="/ajouter-plongeur" method="POST" class="form-container">
            <input type="text" id="nom" name="nom" placeholder="Nom du plongeur" required>
            <div class="niveau-buttons">
                <% ["N1", "N2", "N3", "GP", "E2", "E3", "E4"].forEach(niveau => { %>
                    <button type="button" class="niveau-btn" data-value="<%= niveau %>"><%= niveau %></button>
                <% }) %>
            </div>
            <input type="hidden" id="niveau" name="niveau" value="">
            <button type="submit" class="add-button">Ajouter Plongeur</button>
        </form>

        <h2 class="list-title">Liste des Plongeurs</h2>
        <div class="plongeurs-list">
            <% plongeurs.forEach(plongeur => { %>
                <div class="plongeur-item" data-id="<%= plongeur.id %>">
                    <span class="plongeur-info"><%= plongeur.nom %> - <%= plongeur.niveau %></span>
                    <div class="actions">
                        <button class="edit-btn" onclick="editPlongeur('<%= plongeur.id %>', '<%= plongeur.niveau %>')">‚úèÔ∏è</button>
                        <button class="delete-btn" onclick="deletePlongeur('<%= plongeur.id %>')">‚ùå</button>
                    </div>
                </div>
            <% }) %>
        </div>
    </div>

    <script>
        // Gestion de la s√©lection du niveau
        document.querySelectorAll('.niveau-btn').forEach(button => {
            button.addEventListener('click', function() {
                document.getElementById('niveau').value = this.getAttribute("data-value");
                document.querySelectorAll('.niveau-btn').forEach(btn => btn.classList.remove('selected'));
                this.classList.add('selected');
            });
        });

        // Fonction pour modifier un plongeur
        function editPlongeur(id, currentNiveau) {
            const newNiveau = prompt("Nouveau niveau pour ce plongeur :", currentNiveau);

            // V√©rification que l'utilisateur a bien entr√© un niveau
            if (newNiveau && newNiveau.trim() !== "") {
                console.log(`üìù Modification ID: ${id}, Nouveau Niveau: ${newNiveau}`);

                fetch(`/modifier-plongeur/${id}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ niveau: newNiveau })
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Erreur lors de la modification");
                    }
                    return response.text();
                })
                .then(data => {
                    console.log("‚úÖ Modification r√©ussie :", data);
                    location.reload();
                })
                .catch(error => console.error("‚ùå Erreur :", error));
            }
        }

        // Fonction pour supprimer un plongeur
        function deletePlongeur(id) {
            if (confirm("Voulez-vous vraiment supprimer ce plongeur ?")) {
                console.log(`üöÆ Suppression ID: ${id}`);

                fetch(`/supprimer-plongeur/${id}`, { method: "DELETE" })
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Erreur lors de la suppression");
                    }
                    return response.text();
                })
                .then(data => {
                    console.log("‚úÖ Suppression r√©ussie :", data);
                    location.reload();
                })
                .catch(error => console.error("‚ùå Erreur :", error));
            }
        }
    </script>
</body>
</html>
